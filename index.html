<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Das Verhör | Bullenpower Uri</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lora:ital@1&display=swap');
        
        body { 
            background-color: #000; 
            color: #d4af37; 
            font-family: 'Cinzel', serif; 
            overflow: hidden; 
            margin: 0;
        }

        /* Vignetten-Effekt (Herzschlag) */
        .vignette {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 40%, black 150%);
            pointer-events: none;
            z-index: 50;
            animation: pulse 4s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .page { 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            position: absolute; 
            width: 100%; 
            transition: opacity 0.5s ease-in; 
            z-index: 10;
        }

        .hidden { opacity: 0; pointer-events: none; }

        /* Glitch Effekt für Fragen */
        .glitch {
            position: relative;
            animation: glitch-anim 0.2s 2 ease-in-out;
        }

        @keyframes glitch-anim {
            0% { transform: translate(0); text-shadow: -2px 0 red, 2px 0 blue; }
            20% { transform: translate(-3px, 2px); }
            40% { transform: translate(3px, -2px); }
            100% { transform: translate(0); }
        }

        input { 
            background: transparent; 
            border-bottom: 1px solid #222; 
            outline: none; 
            padding: 10px; 
            width: 100%; 
            max-width: 450px; 
            color: #fff; 
            font-family: 'Lora', serif; 
            font-style: italic; 
            font-size: 1.3rem; 
            text-align: center; 
        }

        #bg-canvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
            opacity: 0.3;
        }
    </style>
</head>
<body>

    <div class="vignette"></div>
    <canvas id="bg-canvas"></canvas>

    <div id="survey-container"></div>

    <div id="final-page" class="page hidden">
        <h2 class="text-2xl mb-4 italic">Danke für deine Zeit.</h2>
        <p class="font-serif text-gray-600 mb-10">Ich hoffe, du hast dich jetzt besser kennengelernt. Ich auf jeden Fall ;)</p>
        <div id="live-list" class="w-full max-w-xs text-xs space-y-2 opacity-50"></div>
    </div>

    <script>
        const FORMSPREE_URL = "https://formspree.io/f/mzdayryq"; 
        const SUPABASE_URL = 'https://xqlxartkonbvzlkvewfq.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_2ntA31uO8udqoaeFbncT8Q_R1rvhyt_';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const fragen = [
            "Wer bist du?", "Wer bist du wirklich?", "Wer willst du sein?", "Wer willst du einmal werden?",
            "Wer wolltest du immer werden?", "Wohin wolltest du schon immer?", "Gefällt es dir, wo du bist?",
            "Wo wärst du am liebsten jetzt?", "Bist du hungrig?", "Was möchtest du jetzt essen?",
            "Warum wartest du auf den ersten Schritt deines Gegenübers?", "Hast du schon einmal etwas gestohlen?",
            "Hast du jemals Drogen konsumiert?", "Hast du schon mal jemand betrogen?", "Bist du ehrlich?",
            "Ist heute schönes Wetter?", "Welches Auto fährst du?", "Wann hast du Feierabend?",
            "Bist du sportlich?", "Hattest du schon mal Angst?", "Vor was denn?",
            "War das Warum der gleiche Grund wie das wovon?", "Welche ist deine Lieblingsfarbe?",
            "Warum?", "Welches ist dein Lieblingsessen?", "Warum?"
        ];

        let answers = {};
        let startTime = Date.now();

        function build() {
            const container = document.getElementById('survey-container');
            fragen.forEach((q, i) => {
                const div = document.createElement('div');
                div.id = `s-${i}`;
                div.className = `page ${i === 0 ? '' : 'hidden'}`;
                div.innerHTML = `
                    <h2 id="q-${i}" class="text-2xl md:text-4xl mb-12 px-6 tracking-widest">${q}</h2>
                    <input type="text" id="i-${i}" onkeypress="checkEnter(event, ${i})" autocomplete="off">
                `;
                container.appendChild(div);
            });
        }

        function checkEnter(e, i) { 
            if(e.key === "Enter") {
                const qText = document.getElementById(`q-${i}`);
                qText.classList.add('glitch'); // Glitch beim Absenden
                setTimeout(() => next(i), 300);
            }
        }

        async function next(i) {
            const val = document.getElementById(`i-${i}`).value;
            answers[`F${i+1}`] = val;
            document.getElementById(`s-${i}`).classList.add('hidden');
            
            if(i + 1 < fragen.length) {
                const nextStep = document.getElementById(`s-${i+1}`);
                nextStep.classList.remove('hidden');
                document.getElementById(`i-${i+1}`).focus();
            } else {
                finish();
            }
        }

        async function finish() {
            const duration = Math.floor((Date.now() - startTime) / 1000);
            const name = answers["F1"] || "Anonym";

            fetch(FORMSPREE_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ...answers, Zeit: duration })
            });

            await supabaseClient.from('survey_results').insert([{ name: name, duration: duration }]);

            document.getElementById('final-page').classList.remove('hidden');
            renderList();
            setTimeout(() => window.location.href = "https://www.bullenpower-uri.ch", 8000);
        }

        async function renderList() {
            const { data } = await supabaseClient.from('survey_results').select('*').order('created_at', { ascending: false }).limit(5);
            if(data) document.getElementById('live-list').innerHTML = data.map(d => `<div>${d.name} — ${d.duration}s</div>`).join('');
        }

        // Hintergrund Nebel-Effekt
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resize; resize();

        for(let i=0; i<50; i++) particles.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, s: Math.random()*2});
        function draw() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "rgba(212, 175, 55, 0.05)";
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.s * 50, 0, Math.PI*2);
                ctx.fill();
                p.y -= 0.2; if(p.y < -100) p.y = canvas.height + 100;
            });
            requestAnimationFrame(draw);
        }
        draw();
        build();
    </script>
</body>
</html>
